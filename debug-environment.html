<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .info-box { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        button { background: #007BFF; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Environment Debug Tool</h1>
        
        <div class="info-box">
            <h3>Current Environment</h3>
            <div id="environmentInfo"></div>
        </div>
        
        <div class="info-box">
            <h3>Manual Override</h3>
            <p>If the auto-detection is wrong, you can force live mode:</p>
            <button onclick="forceLiveMode()">Force Live Mode (Disable Proxy)</button>
            <button onclick="forceLocalMode()">Force Local Mode (Enable Proxy)</button>
            <button onclick="resetMode()">Reset to Auto-Detection</button>
        </div>
        
        <div class="info-box">
            <h3>Test Authentication</h3>
            <button onclick="testAuth()">Test Current Configuration</button>
            <div id="testResult"></div>
        </div>
    </div>

    <script src="auth-manager.js"></script>
    <script>
        function updateEnvironmentInfo() {
            const info = {
                'Full URL': window.location.href,
                'Hostname': window.location.hostname,
                'Protocol': window.location.protocol,
                'Port': window.location.port || 'default',
                'Is Localhost Detected': window.authManager.isLocalhost(),
                'Using Local Proxy': window.authManager.useLocalProxy,
                'Force Live Mode': window.FORCE_LIVE_MODE || false,
                'API Base URL': window.authManager.apiBaseUrl
            };
            
            let html = '<pre>';
            for (const [key, value] of Object.entries(info)) {
                html += `${key}: ${value}\n`;
            }
            html += '</pre>';
            
            document.getElementById('environmentInfo').innerHTML = html;
        }
        
        function forceLiveMode() {
            window.FORCE_LIVE_MODE = true;
            localStorage.setItem('FORCE_LIVE_MODE', 'true');
            location.reload();
        }
        
        function forceLocalMode() {
            window.FORCE_LIVE_MODE = false;
            localStorage.setItem('FORCE_LIVE_MODE', 'false');
            location.reload();
        }
        
        function resetMode() {
            delete window.FORCE_LIVE_MODE;
            localStorage.removeItem('FORCE_LIVE_MODE');
            location.reload();
        }
        
        async function testAuth() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="info-box warning">Testing authentication configuration...</div>';
            
            try {
                // Test the API endpoint that would be used
                const apiUrl = window.authManager.useLocalProxy 
                    ? 'api-proxy.php?endpoint=admin/login'
                    : 'https://core.myacccuratebook.com/admin/login';
                
                resultDiv.innerHTML = `<div class="info-box">
                    <strong>Testing URL:</strong> ${apiUrl}<br>
                    <strong>Method:</strong> ${window.authManager.useLocalProxy ? 'Proxy' : 'Direct'}<br>
                    <em>Making test request...</em>
                </div>`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'test@test.com', password: 'test' })
                });
                
                resultDiv.innerHTML = `<div class="info-box success">
                    <strong>✅ Connection Successful!</strong><br>
                    Status: ${response.status}<br>
                    URL: ${apiUrl}<br>
                    Method: ${window.authManager.useLocalProxy ? 'Proxy' : 'Direct'}
                </div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="info-box error">
                    <strong>❌ Connection Failed!</strong><br>
                    Error: ${error.message}<br>
                    URL: ${window.authManager.useLocalProxy ? 'api-proxy.php' : 'https://core.myacccuratebook.com/admin/login'}<br>
                    Method: ${window.authManager.useLocalProxy ? 'Proxy' : 'Direct'}<br>
                    <br>
                    <strong>Recommendation:</strong> ${window.authManager.useLocalProxy ? 
                        'Try clicking "Force Live Mode" above' : 
                        'This might be a network issue or the API might be down'}
                </div>`;
            }
        }
        
        // Load saved override on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedMode = localStorage.getItem('FORCE_LIVE_MODE');
            if (savedMode !== null) {
                window.FORCE_LIVE_MODE = savedMode === 'true';
            }
            
            updateEnvironmentInfo();
        });
    </script>
</body>
</html>
</content>
</invoke>